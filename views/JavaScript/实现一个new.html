<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <script id="code">
      function A(baz, baz2) {
        this.foo = "foo";
        this.obj = {
          a: 1
        };
        this.baz = baz || "def";
        this.baz2 = baz2 || "def";
      }
      A.prototype.bar = "bar";
      A.prototype.obj2 = {
        b: 2
      };

      function B(baz, baz2) {
        this.foo = "foo";
        this.obj = {
          a: 1
        };
        this.baz = baz || "def";
        this.baz2 = baz2 || "def";
        return { haha: "æˆ‘å°±æ˜¯è¿™ä¹ˆğŸ‚" };
      }
      B.prototype.bar = "bar";
      B.prototype.obj2 = {
        b: 2
      };

      /* 
        new æ˜¯ä»€ä¹ˆï¼Œ
        1. åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œä½¿ç©ºå¯¹è±¡çš„åŸå‹é“¾æŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹ã€‚bar obj2
        2. ç„¶åæ‰§è¡Œæ„é€ å‡½æ•°å†…çš„æ–¹æ³•ï¼Œå†…éƒ¨çš„å±æ€§å¦‚foo objè®©thisæŒ‡å‘æ–°çš„ç©ºå¯¹è±¡
        3. å°†è¿è¡Œç»“æœè¿”å›å›å»ï¼ˆåˆ¤æ–­ä¸€ä¸‹ï¼‰
      */
      function newNew(Con, ...arg) {
        // var _o = {}; //1
        var _o = Object.create(null); //1 åˆ›å»ºä¸€ä¸ªæ²¡æœ‰åŸå‹çš„å¯¹è±¡
        _o.__proto__ = Con.prototype; //1
        var res = Con.apply(_o, arg); //2
        return typeof res === "object" ? res : _o; //3 å› ä¸º æ„é€ å‡½æ•°å¯èƒ½ç›´æ¥æœ‰returnå¼•ç”¨ç±»å‹çš„æ•°æ® [] {} æ‰€ä»¥è¦åˆ¤æ–­ä¸€ä¸‹è¿”å›å€¼
      }
      console.log(newNew(A, 1, 2));
      console.log(newNew(B, 1, 2));
    </script>
  </body>
</html>
